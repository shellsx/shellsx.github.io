<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZXing-js 扫码示例</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        video { width: 100%; max-width: 400px; border: 1px solid #ccc; margin: 10px 0; }
        textarea { width: 100%; height: 100px; }
        button { padding: 10px 15px; margin: 10px; cursor: pointer; }
    </style>
</head>
<body>

    <h2>扫码识别二维码</h2>
    <video id="video" autoplay playsinline></video>
    <button id="startScan">📷 开始扫描</button>
    <button id="stopScan" disabled>🛑 停止扫描</button>

    <h3>二维码内容</h3>
    <textarea id="qrResult" readonly></textarea>
    <button id="copyText">📋 复制内容</button>

    <script type="module">
        import { BrowserQRCodeReader } from "https://cdn.jsdelivr.net/npm/@zxing/browser@latest/+esm";

        const video = document.getElementById("video");
        const qrResult = document.getElementById("qrResult");
        const startScanBtn = document.getElementById("startScan");
        const stopScanBtn = document.getElementById("stopScan");
        const copyBtn = document.getElementById("copyText");

        let codeReader = new BrowserQRCodeReader();
        let stream = null;

        // 启动摄像头并扫描
        async function startScan() {
            try {
                startScanBtn.disabled = true;
                stopScanBtn.disabled = false;

                // 启动摄像头
                stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
                video.srcObject = stream;

                // 开始扫码
                codeReader.decodeFromVideoElement(video, (result, err) => {
                    if (result) {
                        qrResult.value = result.text;  // 识别到二维码内容
                        stopScan();  // 关闭摄像头
                    }
                });
            } catch (err) {
                alert("启动摄像头失败: " + err.message);
                startScanBtn.disabled = false;
                stopScanBtn.disabled = true;
            }
        }

        // 停止扫描并关闭摄像头
        function stopScan() {
            if (stream) {
                let tracks = stream.getTracks();
                tracks.forEach(track => track.stop()); // 关闭摄像头
            }
            startScanBtn.disabled = false;
            stopScanBtn.disabled = true;
        }

        // 复制文本框内容
        copyBtn.addEventListener("click", () => {
            qrResult.select();
            document.execCommand("copy");
            alert("已复制二维码内容");
        });

        // 绑定按钮事件
        startScanBtn.addEventListener("click", startScan);
        stopScanBtn.addEventListener("click", stopScan);
    </script>

</body>
</html>
